From 2befff6aee5a4a1bb27ac1fa1adf396caf7cf17d Mon Sep 17 00:00:00 2001
From: ricolin <rlin@vexxhost.com>
Date: Mon, 24 Mar 2025 18:27:59 +0800
Subject: [PATCH 9/9] Fix pep8 and cherry-pick diff

Change-Id: Ie8ed0526c7814905ae7bbdee6b5eec9dc8ab6f79
---
 ovn_octavia_provider/common/clients.py |  1 +
 ovn_octavia_provider/driver.py         |  2 --
 ovn_octavia_provider/helper.py         | 12 +-----------
 3 files changed, 2 insertions(+), 13 deletions(-)

diff --git a/ovn_octavia_provider/common/clients.py b/ovn_octavia_provider/common/clients.py
index d71101a..38ebb5f 100644
--- a/ovn_octavia_provider/common/clients.py
+++ b/ovn_octavia_provider/common/clients.py
@@ -119,6 +119,7 @@ def get_neutron_client():
         raise driver_exceptions.DriverError(
             operator_fault_string=msg)
 
+
 class OctaviaAuth(metaclass=Singleton):
     def __init__(self):
         """Create Octavia client object."""
diff --git a/ovn_octavia_provider/driver.py b/ovn_octavia_provider/driver.py
index f5cdd9d..58e00c9 100644
--- a/ovn_octavia_provider/driver.py
+++ b/ovn_octavia_provider/driver.py
@@ -624,7 +624,6 @@ class OvnProviderDriver(driver_base.ProviderDriver):
                    'info': request_info}
         self._ovn_helper.add_request(request)
 
-
     def _ensure_loadbalancer(self, loadbalancer):
         try:
             ovn_lbs = self._ovn_helper._find_ovn_lbs_with_retry(
@@ -746,7 +745,6 @@ class OvnProviderDriver(driver_base.ProviderDriver):
                     ovn_lb)
                 self._ovn_helper._update_status_to_octavia(status)
 
-
     def _fip_sync(self, loadbalancer):
         LOG.info("Starting sync floating IP for loadbalancer "
                  f"{loadbalancer.loadbalancer_id}")
diff --git a/ovn_octavia_provider/helper.py b/ovn_octavia_provider/helper.py
index 8555507..e1c994f 100644
--- a/ovn_octavia_provider/helper.py
+++ b/ovn_octavia_provider/helper.py
@@ -434,7 +434,6 @@ class OvnProviderHelper():
     def _neutron_list_ports(self, neutron_client, **params):
         return neutron_client.list_ports(**params)
 
-
     @tenacity.retry(
         retry=tenacity.retry_if_exception_type(
             openstack.exceptions.HttpException),
@@ -542,7 +541,7 @@ class OvnProviderHelper():
             try:
                 self._update_lb_to_ls_association(
                     ovn_lb, network_id=port.network_id,
-                    associate=True, update_ls_ref=True, additional_vips=True,
+                    associate=True, update_ls_ref=True,
                     is_sync=True)
             except idlutils.RowNotFound:
                 LOG.warning("The association of loadbalancer %s to the "
@@ -977,15 +976,6 @@ class OvnProviderHelper():
                     ls_refs[ls_name] += 1
                 else:
                     ls_refs[ls_name] = 1
-                    # NOTE(froyo): To cover the initial lb to ls association,
-                    # where additional vips shall be in the same network as VIP
-                    # port, and the ls_ref[vip_network_id] should take them
-                    # into account.
-                    if additional_vips:
-                        addi_vips = ovn_lb.external_ids.get(
-                            ovn_const.LB_EXT_IDS_ADDIT_VIP_KEY, '')
-                        if addi_vips:
-                            ls_refs[ls_name] += len(addi_vips.split(','))
                     if ovn_ls:
                         commands.append(self.ovn_nbdb_api.ls_lb_add(
                             ovn_ls.uuid, ovn_lb.uuid, may_exist=True))
-- 
2.25.1

